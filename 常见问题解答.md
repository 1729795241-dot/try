# 常见问题解答 (FAQ)

## 📌 关于PDF处理

### Q1: 可以直接把PDF传给DeepSeek吗？

**答：❌ 不可以。**

DeepSeek API（和大多数LLM API）目前只接受**文本输入**，不支持直接上传PDF文件。

**我们的解决方案：**
1. 使用 `pdfplumber` 库先提取PDF中的文本
2. 将提取的文本发送给DeepSeek进行分析
3. 这样可以处理任意长度的PDF文档

**优点：**
- ✅ 支持数百页的长文档
- ✅ 自动分块处理，避免token限制
- ✅ 可以提取PDF中的表格数据
- ✅ 成本更低（只传输文本，不传输图片）

**注意：**
- 只支持**文本型PDF**（可以复制文字的PDF）
- 不支持**扫描版PDF**（图片格式的PDF）
- 如果是扫描版，需要先用OCR工具转换

---

### Q2: 为什么会出现 "KeyError: 'company_info'" 错误？

**原因：**
这是因为DeepSeek返回的JSON格式不正确或解析失败。

**已修复：**
我们已经改进了代码，现在包含：
1. ✅ 更强大的JSON解析逻辑（支持多种格式）
2. ✅ 更清晰的提示词（要求返回纯JSON）
3. ✅ 完善的错误处理（解析失败时使用默认结构）
4. ✅ 详细的调试信息（显示解析失败的原因）

**如果仍然出现问题：**
- 系统会自动使用默认数据结构
- 不会中断整个分析流程
- 仍然会生成表格和图表

---

### Q3: 支持哪些类型的PDF？

**支持：**
- ✅ 文本型PDF（可以选中和复制文字）
- ✅ 财务报表、年报、季报
- ✅ 包含表格的PDF
- ✅ 中文和英文PDF
- ✅ 数百页的长文档

**不支持：**
- ❌ 扫描版PDF（纯图片）
- ❌ 加密的PDF
- ❌ 损坏的PDF文件

**建议：**
- 文件大小：< 200MB
- 页数：< 500页（超过会自动截取前50页）
- 格式：标准PDF 1.4或更高版本

---

## 🔧 技术问题

### Q4: 为什么分析很慢？

**正常处理时间：**
- 10页PDF：约30秒
- 50页PDF：约1-2分钟
- 100页PDF：约2-3分钟

**影响速度的因素：**
1. PDF文件大小和页数
2. DeepSeek API响应速度
3. 网络连接速度
4. 生成图表的数量

**优化建议：**
- 只上传需要分析的部分（不要上传整个几百页的文档）
- 确保网络连接稳定
- 避免同时处理多个文件

---

### Q5: API调用失败怎么办？

**常见原因：**
1. API密钥错误或过期
2. 网络连接问题
3. API配额用完
4. 文本太长超过token限制

**解决方法：**
1. 检查API密钥是否正确
2. 检查网络连接
3. 查看DeepSeek账户余额
4. 减少PDF页数

**错误信息示例：**
```
401 Unauthorized - API密钥无效
429 Too Many Requests - 请求过于频繁
500 Internal Server Error - API服务器错误
```

---

### Q6: 提取的数据不准确怎么办？

**可能原因：**
1. PDF格式复杂，文本提取不完整
2. 财务数据格式不标准
3. LLM理解错误

**改进方法：**
1. **调整提示词**：编辑 `src/llm_client.py` 中的提示词
2. **增加上下文**：修改 `src/financial_agent.py` 中的文本长度限制
3. **手动修正**：下载JSON文件后手动编辑

**示例：修改文本长度限制**
```python
# 在 src/llm_client.py 第132行
prompt.format(text=text[:8000])  # 改为 text[:16000]
```

---

## 📊 功能相关

### Q7: 可以批量处理多个PDF吗？

**答：✅ 可以！**

**方法1：使用命令行工具**
```bash
python cli.py report1.pdf report2.pdf report3.pdf
```

**方法2：使用Python代码**
```python
from src.workflow import FinancialWorkflow

workflow = FinancialWorkflow()
results = workflow.run_batch([
    "report1.pdf",
    "report2.pdf",
    "report3.pdf"
])
```

**方法3：Web界面**
- 目前Web界面只支持单文件上传
- 可以多次上传，结果会保存在历史记录中

---

### Q8: 生成的图表可以自定义吗？

**答：✅ 可以！**

编辑 `src/visualizer.py` 文件，可以自定义：
- 图表类型
- 颜色方案
- 字体大小
- 图表尺寸
- 显示内容

**示例：修改颜色**
```python
# 在 src/visualizer.py 中
colors = ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728']  # 修改这里
```

---

### Q9: 可以导出其他格式吗？

**当前支持的格式：**
- ✅ Excel (.xlsx)
- ✅ CSV (.csv)
- ✅ JSON (.json)
- ✅ 文本报告 (.txt)
- ✅ PNG图片 (.png)
- ✅ HTML交互图表 (.html)

**未来可能支持：**
- PDF报告
- Word文档
- PowerPoint演示文稿

**自定义导出：**
可以修改 `src/table_generator.py` 和 `src/visualizer.py` 来添加新的导出格式。

---

## 🚀 使用技巧

### Q10: 如何获得最佳分析效果？

**建议：**

1. **使用高质量的PDF**
   - 文本清晰可复制
   - 表格格式规范
   - 避免扫描版

2. **提供完整的财务报表**
   - 包含资产负债表
   - 包含利润表
   - 包含现金流量表

3. **合理设置参数**
   - 不要上传过长的PDF（建议<100页）
   - 确保API密钥有效
   - 网络连接稳定

4. **验证结果**
   - 检查提取的数据是否准确
   - 对比原始PDF
   - 必要时手动修正

---

### Q11: 如何集成到现有系统？

**作为Python库使用：**

```python
from src.workflow import FinancialWorkflow

# 创建工作流
workflow = FinancialWorkflow(
    api_key="your_api_key",
    output_dir="output"
)

# 处理PDF
result = workflow.run("report.pdf")

# 获取结果
financial_data = result['financial_data']
excel_path = result['files']['excel']
charts = result['files']['charts']
```

**作为API服务：**
- 可以基于 `app.py` 修改为REST API
- 使用Flask或FastAPI框架
- 部署到服务器

---

### Q12: 数据安全吗？

**安全措施：**
1. ✅ API密钥存储在 `.env` 文件中（不会上传到Git）
2. ✅ PDF文件在本地处理
3. ✅ 只有文本发送到DeepSeek API
4. ✅ 所有结果保存在本地

**注意事项：**
- 不要在公共场合分享 `.env` 文件
- 不要将API密钥硬编码在代码中
- 定期更换API密钥
- 敏感数据建议在本地处理

---

## 💡 其他问题

### Q13: 如何更新系统？

**更新依赖：**
```bash
pip install --upgrade -r requirements.txt
```

**更新代码：**
- 直接修改源代码文件
- 或者从Git仓库拉取最新版本

---

### Q14: 遇到问题如何调试？

**启用详细日志：**
```bash
# 使用命令行工具的verbose模式
python cli.py report.pdf -v
```

**查看错误信息：**
- Web界面会显示详细的错误信息
- 命令行会输出完整的堆栈跟踪
- 检查 `output/` 目录中的文件

**常用调试方法：**
1. 运行 `test_demo.py` 验证基本功能
2. 运行 `test_json_parsing.py` 测试JSON解析
3. 检查API密钥是否正确
4. 查看网络连接

---

### Q15: 如何贡献代码或报告问题？

**报告问题：**
- 描述问题现象
- 提供错误信息
- 说明使用的PDF类型
- 提供系统环境信息

**改进建议：**
- 新功能需求
- 性能优化建议
- 用户体验改进
- 文档完善

---

## 📞 联系支持

如果以上FAQ没有解决你的问题，可以：
1. 查看项目文档（README.md、项目说明.md）
2. 运行测试脚本验证功能
3. 检查错误日志
4. 尝试使用演示数据测试

---

**最后更新：2025-10-28**
**版本：1.0.0**

